# Squid proxy configuration for Phase 4 autonomous agent
# Implements URL allowlisting to simulate enterprise network restrictions

# Listening port
http_port 3128

# Access control lists (ACLs)
acl allowed_domains dstdomain .httpbin.org
acl allowed_domains dstdomain .allowed-domain.com
# LLM API endpoints - must be allowed for agent to function
acl llm_apis dstdomain .openai.com
acl llm_apis dstdomain .googleapis.com
acl llm_apis dstdomain .anthropic.com
# LangSmith tracing - allowed for observability
acl llm_apis dstdomain .smith.langchain.com
acl localhost src 127.0.0.1/32 ::1
acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1

# SSL bump configuration (to intercept HTTPS)
# We won't do SSL interception for simplicity

# Access rules
http_access allow localhost
http_access allow llm_apis
http_access allow allowed_domains
http_access deny all

# Logging
access_log /var/log/squid/access.log squid
cache_log /var/log/squid/cache.log
cache_store_log /var/log/squid/store.log

# Log format with more details
logformat detailed %ts.%03tu %6tr %>a %Ss/%03>Hs %<st %rm %ru %[un %Sh/%<a %mt

# Disable caching (we want to see all requests)
cache deny all

# Visible hostname
visible_hostname phase4-proxy

# Error messages
error_directory /usr/share/squid/errors/en

# Forwarded-For header
forwarded_for on

# Memory configuration
cache_mem 64 MB
maximum_object_size_in_memory 512 KB
memory_replacement_policy heap GDSF
memory_pools off

# Coredump directory
coredump_dir /var/spool/squid
